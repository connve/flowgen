flow:
  name: script_inline_multiline
  require_leader_election: true
  tasks:

    # Generate triggers the flow once after 5 seconds.
    - generate:
        name: trigger
        interval: 5s
        count: 1

    # Inline multi-line script to transform and enrich event data.
    # Uses YAML pipe | for multi-line script.
    - script:
        name: enrich_data
        code: |
          // Extract values from incoming event
          let value = event.data.value;
          let category = event.data.category;

          // Add calculated fields
          event.data.doubled = value * 2;
          event.data.squared = value * value;
          event.data.category_upper = category.to_upper();

          // Add metadata
          event.data.processed_at = timestamp_now();

          // Return modified event
          event

    # Log the enriched event to console.
    - log:
        name: log_result
        level: info
        structured: false
