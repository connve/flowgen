flow:
  name: "mongo_change_stream_reader"
  tasks:
    # Read database changes from mongo.
    - mongo_change_stream:
        name: "mongo_change_stream"
        credentials_path: "/etc/mongo/credentials.json"
        db_name: "rust-example"
    
    # Publish events to NATS for extra durability.
    - nats_jetstream_publisher:
        name: publish_events
        credentials_path: /etc/nats/credentials.json
        subject: pubsub.data.mongo
        stream:
          create_or_update: true
          name: mongo
          description: "Mongo CDC events."
          subjects: ["pubsub.data.mongo",]
          max_age_secs: 86400
          retention: limits
          discard_policy: old